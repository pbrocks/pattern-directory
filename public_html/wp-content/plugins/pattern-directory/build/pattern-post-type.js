!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.plugins,n=window.wp.element,s=window.wp.i18n,r=window.wp.editPost,a=window.wp.components,o=window.wp.editor,l=window.wp.data;const i="unlisted";var u=window.wp.a11y,p=window.wp.coreData,c=window.wp.apiFetch,g=e.n(c);const d=()=>{},m={hasError:!1,isSubmitted:!1,isSubmitting:!1,message:null,reasonList:[]},w=(e,t)=>{const n={hasError:!1,isSubmitted:!1,isSubmitting:!1,message:null};switch(t.status){case"NOTE_SENT":return{...e,...n,isSubmitting:!0};case"NOTE_RECIEVED":return{...e,...n,isSubmitted:!0};case"REASONS_RECIEVED":return{...e,...n,reasonList:t.reasonList};case"ERROR":return{...e,...n,hasError:!0,message:t.message};default:return e}};var _=e=>{let{onClose:t,onSubmit:r}=e;const i=(0,l.useSelect)((e=>{const t=e(o.store).getCurrentPostId(),n=e(o.store).getCurrentPostType(),{rest_base:s}=e(p.store).getPostType(n);return`/wp/v2/${s}/${t}/internal-notes`})),[c,_]=(0,n.useReducer)(w,m),[h,E]=(0,n.useState)(""),[b,S]=(0,n.useState)(""),f=(0,n.useRef)();(0,n.useEffect)((()=>{(e=>{let{onSuccess:t=d,onFailure:n=d}=e;g()({path:"/wp/v2/wporg-pattern-flag-reason"}).then((e=>{const n=e.sort(((e,t)=>{switch(!0){case e.slug<t.slug:return-1;case e.slug>t.slug:return 1;default:return 0}})).map((e=>({label:e.name,value:e.slug})));t(n)})).catch(n)})({onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_({status:"REASONS_RECIEVED",reasonList:e})},onFailure:e=>{_({status:"ERROR",message:e.message})}})}),[]);const v=(0,s.__)("The pattern has been unlisted, and your internal note has been saved.","wporg-patterns"),P=()=>{t()};return(0,n.createElement)(a.Modal,{title:(0,s.__)("Unlist this pattern","wporg-patterns"),onRequestClose:P,className:"wporg-patterns-unlist__modal"},(0,n.createElement)("div",{ref:f},c.isSubmitted?(0,n.createElement)("p",null,v):(0,n.createElement)("form",{onSubmit:e=>{if(e.preventDefault(),c.isSubmitted||c.isSubmitting)return;if(!h||!b.length)return void _({status:"ERROR",message:(0,s.__)("Please select a reason and add an internal note.","wporg-patterns")});const t=c.reasonList.find((e=>{let{value:t}=e;return t===h}));_({status:"NOTE_SENT"}),(e=>{let{url:t,note:n,onSuccess:s=d,onFailure:r=d}=e;g()({path:t,method:"POST",data:{excerpt:n}}).then(s).catch(r)})({url:i,note:`UNLISTED: ${t.label} — ${b}`,onSuccess:()=>{"function"==typeof r&&r(h),_({status:"NOTE_RECIEVED"}),(0,u.speak)(v),f.current.closest('[role="dialog"]').focus()},onFailure:e=>{_({status:"ERROR",message:e.message}),(0,u.speak)((0,s.sprintf)(
/* translators: %s: Error message. */
(0,s.__)("Error: %s","wporg-patterns"),e.message))}})}},c.reasonList.length?(0,n.createElement)(a.RadioControl,{className:"wporg-patterns-unlist__reasons",label:(0,s.__)("Please choose a reason:","wporg-patterns"),help:(0,s.__)("The reason chosen will be used to show a message to the pattern author.","wporg-patterns"),selected:h,options:c.reasonList,onChange:E,required:!0}):(0,n.createElement)(a.Spinner,null),(0,n.createElement)(a.TextareaControl,{label:(0,s.__)("Please provide internal details (required)","wporg-patterns"),help:(0,s.__)("This note will only be seen by other admins and moderators.","wporg-patterns"),value:b,onChange:S,required:!0}),c.hasError&&(0,n.createElement)("div",{className:"notice notice-large notice-alt notice-error"},c.message),(0,n.createElement)("div",{className:"wporg-patterns-unlist__actions"},(0,n.createElement)(a.Button,{isSecondary:!0,onClick:P},(0,s.__)("Cancel","wporg-patterns")),(0,n.createElement)(a.Button,{type:"submit",isBusy:c.isSubmitting,isPrimary:!0},c.isSubmitting?(0,s.__)("Submitting …","wporg-patterns"):(0,s.__)("Unlist Pattern","wporg-patterns"))))))},h=window.wp.notices,E=()=>{const e=(0,l.useSelect)((e=>e(o.store).getCurrentPostAttribute("status")),[]),{createNotice:t,removeNotice:r}=(0,l.useDispatch)(h.store),a="unlisted-pattern-notice";return(0,n.useEffect)((()=>{e===i?t("warning",(0,s.__)("This pattern is unlisted. It will not appear in the public pattern directory.","wporg-patterns"),{id:a,isDismissible:!1}):r(a)}),[e]),null};const b=()=>{const e=(0,l.useSelect)((e=>e(o.store).getCurrentPost().status)),{editPost:t,savePost:u}=(0,l.useDispatch)(o.store),[p,c]=(0,n.useState)(!1),g=e===i?"wporg-patterns-unlist-notice":"wporg-patterns-unlist-button";return(0,n.createElement)(r.PluginPostStatusInfo,{className:g},e!==i?(0,n.createElement)(n.Fragment,null,(0,n.createElement)(a.Button,{onClick:()=>c(!0),isSecondary:!0},(0,s.__)("Unlist","wporg-patterns")),(0,n.createElement)("small",null,(0,s.__)("Remove from the pattern directory","wporg-patterns"))):(0,n.createElement)(n.Fragment,null,(0,n.createElement)("h3",null,(0,s.__)("Unlisted","wporg-patterns")),(0,n.createElement)("small",null,(0,s.__)("Use the Publish button to re-list this pattern. Note: This overrides the status settings shown above.","wporg-patterns"))),p&&(0,n.createElement)(_,{onSubmit:e=>{t({status:i,meta:{wpop_unlisted_reason:e}}),u()},onClose:()=>c(!1)}))},S=window.wporgLocaleData||{},f=[];for(const[e,t]of Object.entries(S))f.push({value:e,label:t});var v=()=>{const{editPost:e}=(0,l.useDispatch)("core/editor"),t=(0,l.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta")||{})),o=(0,l.useSelect)((e=>e("core/editor").getEditedPostAttribute("title")||""));return(0,n.createElement)(r.PluginDocumentSettingPanel,{name:"wporg-pattern-details",title:(0,s.__)("Pattern Details","wporg-patterns"),icon:"nothing"},(0,n.createElement)(a.TextControl,{key:"title",label:(0,s.__)("Title","wporg-patterns"),value:o,placeholder:(0,s.__)("Pattern title","wporg-patterns"),onChange:t=>e({title:t})}),(0,n.createElement)(a.TextareaControl,{key:"description",label:(0,s.__)("Description","wporg-patterns"),value:t.wpop_description,onChange:n=>e({meta:{...t,wpop_description:n}}),help:(0,s.__)("The description is used to help users of assistive technology understand the content of your pattern.","wporg-patterns")}),(0,n.createElement)(a.ComboboxControl,{key:"locale",label:(0,s.__)("Language","wporg-patterns"),options:f,value:t.wpop_locale,onChange:n=>e({meta:{...t,wpop_locale:n}}),help:(0,s.__)("The language field is used to help users find patterns that were created in their preferred language.","wporg-patterns")}))};(0,t.registerPlugin)("pattern-post-type",{render:()=>(0,n.createElement)(n.Fragment,null,(0,n.createElement)(b,null),(0,n.createElement)(E,null),(0,n.createElement)(v,null))})}();